<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

<link rel="stylesheet" href="static/nv.d3.css">
<link rel="stylesheet" href="static/chosen.css">

<title>Vis Binary Data</title>
</head>

<body>
<div class="container-fluid">

<div class="filter row "> 

<div class="form-group col-md-1">
    <label for="Start Age">Start Age</label>
    <input type="text" class="form-control" id="age_start" placeholder="Start Age" value="1">
  </div>

<div class="form-group col-md-1">
    <label for="Start Age">End Age</label>
    <input type="text" class="form-control" id="age_end" placeholder="End Age" value="125">
  </div>

 <div class="form-group col-md-1">
    <label for="Start Age">Gender</label>
  <select id="gender" class="form-control">
      <option value="0">All</option>
      <option value="1">Male</option>
      <option value="2">Female</option>
      </select>
  </div>

 <div class="form-group col-sm-2">
    <label for="Start Age">Education Level</label>
    <select id="education" class="form-control">

      <option value="0">Discard</option>
      <option value="1">Some primary</option>
      <option value="2">Finished primary</option>

      <option value="3">Some secondary</option>
      <option value="4">Finished secondary</option>
      </select>
  </div>

 <div class="form-group col-md-2">
    <label for="Start Age">Countries</label>
    <select multiple id="country" name="country" data-placeholder="Choose Countries..." class="form-control chosen-select">
                                <option value=0 > All countries</option>
                                <option value=1 > Afghanistan</option>
                                <option value=2 > Albania</option>
                                <option value=3 > Algeria</option>
                                <option value=4 > Andorra</option>
                                <option value=5 > Angola</option>
                                <option value=6 > Antigua and Barbuda</option>
                                <option value=7 > Argentina</option>
                                <option value=8 > Armenia</option>
                                <option value=9 > Austraoptiona</option>
                                <option value=10 > Austria</option>
                                <option value=11 > Azerbaijan</option>
                                <option value=12 > Bahamas</option>
                                <option value=13 > Bahrain</option>
                                <option value=14 > Bangladesh</option>
                                <option value=15 > Barbados</option>
                                <option value=16 > Belarus</option>
                                <option value=17 > Belgium</option>
                                <option value=18 > Beoptionze</option>
                                <option value=19 > Benin</option>

                                <option value=20 > Bhutan</option>
                                <option value=21 > Booptionvia (Plurinational State of)</option>
                                <option value=22 > Bosnia and Herzegovina</option>
                                <option value=23 > Botswana</option>
                                <option value=24 > Brazil</option>
                                <option value=25 > Brunei Darussalam</option>
                                <option value=26 > Bulgaria</option>
                                <option value=27 > Burkina Faso</option>
                                <option value=28 > Burundi</option>
                                <option value=29 > Cambodia</option>
                                <option value=30 > Cameroon</option>
                                <option value=31 > Canada</option>
                                <option value=32 > Cape Verde</option>
                                <option value=33 > Central African Repuboptionc</option>
                                <option value=34 > Chad</option>
                                <option value=35 > Chile</option>
                                <option value=36 > China</option>
                                <option value=37 > Colombia</option>
                                <option value=38 > Comoros</option>
                                <option value=39 > Congo</option>
                                <option value=40 > Costa Rica</option>
                                <option value=41 > Cote d'Ivoire</option>
                                <option value=42 > Croatia</option>

                                <option value=43 > Cuba</option>
                                <option value=44 > Cyprus</option>
                                <option value=45 > Czech Repuboptionc</option>
                                <option value=46 > Democratic People's Repuboptionc of Korea</option>
                                <option value=47 > Democratic Repuboptionc of the Congo</option>
                                <option value=48 > Denmark</option>
                                <option value=49 > Djibouti</option>
                                <option value=50 > Dominica</option>
                                <option value=51 > Dominican Repuboptionc</option>
                                <option value=52 > Ecuador</option>
                                <option value=53 > Egypt</option>
                                <option value=54 > El Salvador</option>
                                <option value=55 > Equatorial Guinea</option>
                                <option value=56 > Eritrea</option>
                                <option value=57 > Estonia</option>
                                <option value=58 > Ethiopia</option>
                                <option value=59 > Fiji</option>
                                <option value=60 > Finland</option>
                                <option value=61 > France</option>
                                <option value=62 > Gabon</option>
                                <option value=63 > Gambia</option>
                                <option value=64 > Georgia</option>
                                <option value=65 > Germany</option>
                                <option value=66 > Ghana</option>
                                <option value=67 > Greece</option>
                                <option value=68 > Grenada</option>
                                <option value=69 > Guatemala</option>
                                <option value=70 > Guinea</option>
                                <option value=71 > Guinea-Bissau</option>
                                <option value=72 > Guyana</option>
                                <option value=73 > Haiti</option>
                                <option value=74 > Honduras</option>
                                <option value=75 > Hungary</option>
                                <option value=76 > Iceland</option>
                                <option value=77 > India</option>
                                <option value=78 > Indonesia</option>
                                <option value=79 > Iran (Islamic Repuboptionc of)</option>
                                <option value=80 > Iraq</option>
                                <option value=81 > Ireland</option>
                                <option value=82 > Israel</option>
                                <option value=83 > Italy</option>
                                <option value=84 > Jamaica</option>

                                <option value=85 > Japan</option>
                                <option value=86 > Jordan</option>
                                <option value=87 > Kazakhstan</option>
                                <option value=88 > Kenya</option>
                                <option value=89 > Kiribati</option>
                                <option value=90 > Kuwait</option>
                                <option value=91 > Kyrgyzstan</option>
                                <option value=92 > Lao People's Democratic Repuboptionc</option>
                                <option value=93 > Latvia</option>
                                <option value=94 > Lebanon</option>
                                <option value=95 > Lesotho</option>
                                <option value=96 > Optionberia</option>
                                <option value=97 > Optionbya</option>
                                <option value=98 > Optionechtenstein</option>
                                <option value=99 > Optionthuania</option>
                                <option value=100 > Luxembourg</option>
                                <option value=101 > Madagascar</option>
                                <option value=102 > Malawi</option>
                                <option value=103 > Malaysia</option>
                                <option value =104 > Maldives</option>
                                <option value=105 > Maoption</option>
                                <option value=106 > Malta</option>
                                <option value=107 > Marshall Islands</option>
                                <option value=108 > Mauritania</option>
                                <option value=109 > Mauritius</option>
                                <option value=110 > Mexico</option>
                                <option value=111 > Micronesia (Federated States of)</option>
                                <option value=112 > Monaco</option>
                                <option value=113 > Mongooptiona</option>
                                <option value=114 > Montenegro</option>
                                <option value=115 > Morocco</option>
                                <option value=116 > Mozambique</option>
                                <option value=117 > Myanmar</option>
                                <option value=118 > Namibia</option>
                                <option value=119 > Nauru</option>
                                <option value=120 > Nepal</option>
                                <option value=121 > Netherlands</option>
                                <option value=122 > New Zealand</option>
                                <option value=123 > Nicaragua</option>
                                <option value=124 > Niger</option>
                                <option value=125 > Nigeria</option>
                                <option value=126 > Norway</option>
                                <option value=127 > Oman</option>
                                <option value=128 > Pakistan</option>
                                <option value=129 > Palau</option>
                                <option value=130 > Panama</option>
                                <option value=131 > Papua New Guinea</option>
                                <option value=132 > Paraguay</option>
                                <option value=133 > Peru</option>
                                <option value=134 > Phioptionppines</option>
                                <option value=135 > Poland</option>
                                <option value=136 > Portugal</option>
                                <option value=137 > Qatar</option>
                                <option value=138 > Repuboptionc of Korea</option>
                                <option value=139 > Repuboptionc of Moldova</option>
                                <option value=140 > Romania</option>
                                <option value=141 > Russian Federation</option>
                                <option value=142 > Rwanda</option>
                                <option value=143 > Saint Kitts and Nevis</option>
                                <option value=144 > Saint Lucia</option>
                                <option value=145 > Saint Vincent and the Grenadines</option>
                                <option value=146 > Samoa</option>
                                <option value=147 > San Marino</option>
                                <option value=148 > Sao Tome and Principe</option>
                                <option value=149 > Saudi Arabia</option>
                                <option value=150 > Senegal</option>
                                <option value=151 > Serbia</option>
                                <option value=152 > Seychelles</option>
                                <option value=153 > Sierra Leone</option>
                                <option value=154 > Singapore</option>
                                <option value=155 > Slovakia</option>
                                <option value=156 > Slovenia</option>
                                <option value=157 > Solomon Islands</option>
                                <option value=158 > Somaoptiona</option>
                                <option value=159 > South Africa</option>
                                <option value=160 > South Sudan</option>
                                <option value=161 > Spain</option>
                                <option value=162 > Sri Lanka</option>
                                <option value=163 > Sudan</option>
                                <option value=164 > Suriname</option>
                                <option value=165 > Swaziland</option>
                                <option value=166 > Sweden</option>
                                <option value=167 > Switzerland</option>
                  <option value=168 > Syrian Arab Repuboptionc</option>
                  <option value=169 > Tajikistan</option>
                  <option value=170 > Thailand</option>
                  <option value=171 > The former Yugoslav Repuboptionc of Macedonia</option>
                  <option value=172 > Timor-Leste</option>
                  <option value=173 > Togo</option>
                  <option value=174 > Tonga</option>
                  <option value=175 > Trinidad and Tobago</option>
                  <option value=176 > Tunisia</option>
                  <option value=177 > Turkey</option>
                  <option value=178 > Turkmenistan</option>
                  <option value=179 > Tuvalu</option>
                  <option value=180 > Uganda</option>
                  <option value=181 > Ukraine</option>
                  <option value=182 > United Arab Emirates</option>
                  <option value=183 > United Kingdom of Great Britain and Northern Ireland</option>
                  <option value=184 > United Repuboptionc of Tanzania</option>
                  <option value=185 > United States of America</option>
                  <option value=186 > Uruguay</option>
                  <option value=187 > Uzbekistan</option>
                  <option value=188 > Vanuatu</option>
                  <option value=189 > Venezuela (Booptionvarian Repuboptionc of)</option>
                  <option value=190 > Viet Nam</option>
                  <option value=191 > Yemen</option>
                  <option value=192 > Zambia</option>
                  <option value=193 > Zimbabwe</option>
        </select>
  </div>

 <div class="form-group col-md-2">
    <label for="Group By">Group By</label>
     <select id="groupby" class="form-control">
      <option selected="selected">GroupBy</option>
      <option>Gender</option>
      <option>Education</option>
      </select>
  </div>

   <div class="form-group col-md-1">
    <label for="Start Age">Count Min</label>
  <input class="form-control" type="text" id ="minimum" value ="0"/> 
  </div>

  <div class="col-md-1 form-group">
   <label for="Button">Let's roll</label>
  <button id="filter_button" class="btn btn-default">Magic Button</button></div>
</div>

</div>

    <div class="container-fluid">

      <div class="row">

        <div id="test1_left" class="with-3d-shadow with-transitions col-md-8" style="height:1000px">
          <svg></svg>
        </div>

        <div class="col-md-3"> 
          <table id="prioritytable" class="table"><tbody><tr> <td><b>Priority Values</b> <button  onclick = "removeClass()">Clear</button> </td> </tr>

            <tr> <td>  <ul>
                  <li id="p0"><strong>100</strong> = "Action taken on climate change" </li>
                  <li id="p1"><strong>101</strong> = "Better transport and roads"</li>
                  <li id="p2"><strong>102</strong> = "Support for people who can't work" </li>
                  <li id="p3"><strong>103</strong> = "Access to clean water and sanitation" </li>
                  <li id="p4"><strong>104</strong> = "Better healthcare" </li>
                  <li id="p5"><strong>105</strong> = "A good education" </li>
                  <li id="p6"><strong>106</strong> = "A responsive government we can trust" </li>
                  <li id="p7"><strong>107</strong> = "Phone and internet access" </li>
                  <li id="p8"><strong>108</strong> = "Reliable energy at home" </li>
                  <li id="p9"><strong>109</strong> = "Affordable and nutritious food" </li>
                  <li id="p10"><strong>110</strong> = "Protecting forests, rivers and oceans" </li>
                  <li id="p11"><strong>112</strong> = "Political freedoms" </li>
                  <li id="p12"><strong>111</strong> = "Protection against crime and violence" </li>
                  <li id="p13"><strong>113</strong> = "Freedom from discrimination and persecution" </li>
                  <li id="p14"><strong>114</strong> = "Equality between men and women" </li>
                  <li id="p15"><strong>115</strong> = "Better job opportunities" </li>
                </ul> </td> </tr>
          </tbody> </table>
        </div>


      <div class="kmeans col-md-3">

  <table id="k-points" class="table">
  <tbody></tbody>
  
  </table>
 <div class="col-md-1 form-group">
  <button id="k_button" class="btn btn-default">K-Means</button></div>
</div>
       </div>
      </div>

</div>


  <div class="container-fluid">
        <div class="row">

        <div id="test1_left2" class="with-3d-shadow with-transitions col-md-8" style="height:1000px">
          <svg></svg>
        </div>

</div>


<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="static/d3.v3.js"></script>
<script src="static/nv.d3.js"></script>
<script src="static/chosen.jquery.js" type="text/javascript"></script>

<script>
var detailButtonBitStr = "";
var detailButtonUrlStr = "";

$(document).ready(function(){
$(".chosen-select").chosen();

})

$("#filter_button").click(function(){
      var ageStart = $("#age_start").val();
      var ageEnd = $("#age_end").val();
      var gender = $("#gender").val();
      var education = $("#education").val();
      var country = $("#country").val();
      var page = 1;
      var group = $("#groupby").val();
      var min = $("#minimum").val();
      var urlString = "start=" + ageStart + "&end=" + ageEnd + "&gender=" + gender + "&education="
                      + education +  "&country=" + country + "&p=" + page;

      //console.log(urlString);

      if (group == "Gender") {

           $.ajax({
            type: "GET",
            //url: "mydataGender.json",
            //dataType: "json",            
            url: "record/search/group/?callback=abc&group_by=gender&" + urlString,
            dataType: "jsonp",        
            success: function(data) {              
              drawGraph(data, 'left', urlString, 'groupG', min);
            },
            error : function(httpReq,status,exception){
                alert(status+" "+exception);
            }
          });
      } else if (group == "Education") {
           $.ajax({
            type: "GET",
           // url: "mydataEdu.json",
           // dataType: "json",           
            url: "record/search/group/?callback=abc&group_by=education&" + urlString,
            dataType: "jsonp",        
            success: function(data) {              
              drawGraph(data, 'left', urlString, 'groupE', min);
            },
            error : function(httpReq,status,exception){
                alert(status+" "+exception);
            }
          });
      } else {
           $.ajax({
            type: "GET",
            //url: "mydata1.json",
            //dataType: "json",           
            url: "record/search/aggregation/?callback=abc&" + urlString,
            dataType: "jsonp",        
            success: function(data) {              
              drawGraph(data, 'left', urlString, 'nogroup', min);
            },
            error : function(httpReq,status,exception){
                alert(status+" "+exception);
            }
          });       
      }


    });




$("#k_button").click(function(){

      var ageStart = $("#age_start").val();
      var ageEnd = $("#age_end").val();
      var gender = $("#gender").val();
      var education = $("#education").val();
      var country = $("#country").val();
      var page = 1;
      var group = $("#groupby").val();
      var min = $("#minimum").val();
      var urlString = "start=" + ageStart + "&end=" + ageEnd + "&gender=" + gender + "&education="
                      + education +  "&country=" + country + "&p=" + page;
      $('#k-points tr').each(function() {
        urlString += "&point=" +$(this).find("td").html();    
       });

      //console.log(urlString);

           $.ajax({
            type: "GET",
            //url: "mydataGender.json",
            //dataType: "json",            
            url: "record/kmeans/?callback=abc&group_by=gender&" + urlString,
            dataType: "jsonp",        
            success: function(data) {              
              drawGraph(data, 'left2', urlString, 'groupK', min);
            },
            error : function(httpReq,status,exception){
                alert(status+" "+exception);
            }
          });})


function drawGraph(source, myPage, urlStr, group, mincount) {
  //Format A
  var chart;
  nv.addGraph(function() {
    chart = nv.models.scatterChart()
                  .showDistX(false)
                  .showDistY(false)
                  .useVoronoi(false)
                  .color(d3.scale.category10().range())
                  .transitionDuration(300)
                  ;
                  //------------------------------------------tooltipsection-----------------------------
    chart.xAxis.tickFormat(d3.format('.02f'));
    chart.yAxis.tickFormat(d3.format('.02f'));
    chart.tooltipContent(function(a,b,c,d) {
        //console.log(d["point"]["size"]);
        removeClass();
        var bitstr = d["point"]["bitstring"];
        var buttonID = "#detail_" + myPage;
        $('#suggbutton').prop("disabled", false);
        detailButtonUrlStr = urlStr;
        detailButtonBitStr = bitstr;

       highlightPri(bitstr);
        return "BitString: <b>" + bitstr + "</b> Count: <b>" + d["point"]["size"] + "</b>" ;
    });

    chart.scatter.onlyCircles(false);
    var pg = "#test1_" + myPage + " svg";
    d3.select(pg)
        .datum(getData(source, group, mincount))
        .call(chart);

    nv.utils.windowResize(chart.update);

    chart.dispatch.on('stateChange', function(e) { ('New State:', JSON.stringify(e)); });

    return chart;
  },function(){
         $(".nv-point").on('click',
               function(){
                bitstring = $(".xy-tooltip b").html().toString();
                $("#k-points tbody:last").append('<tr><td>'+bitstring+'</td></tr>');
                console.log(bitstring);
           });

      });  
}

function highlightPri(str) {
  for (i = 0; i < str.length; i++) {
    var j = "#p" + i;
    if (str.charAt(i) == '0') $(j).addClass("fade");
    else $(j).addClass("highlight");
  }
}

function removeClass() {
  for (i = 0; i < 16; i++) {
    var j = "#p" + i;
    $(j).removeClass();
  }

}

function addOne(d) {
  d.digit++;
  console.log(d.digit);
}





function getData(source, group, mincount) { //# groups,# points per group
  //console.log(source);
  if (group == "nogroup") {  //no grouping
      var data = [{key: "# of same response",values: []}];
      var objList = source["data"]["bitstrings"];
      
      for (i = 0; i < objList.length; i++) {
        var origin = objList[i]["bitstring"]["origin"];
        var str = objList[i]["bitstring"]["nmds"];
        var s = parseInt(objList[i]["count"]);
        if (s >= mincount) {
           data[0].values.push({
            x: parseFloat(str.split(",")[0]),
            y: parseFloat(str.split(",")[1]),
            size: parseInt(objList[i]["count"]),
            shape: 'circle',
            bitstring: origin
          });         
        }

      }        
  } else if (group == "groupG") {
    //group by gender
    var data = [{key: "Male", values: []}, {key: "Female", values: []}];

    var maleArray = source["data"]["male"];

    var feArray = source["data"]["female"];
    for (i = 0; i < maleArray.length; i++) {
       var s = parseInt(maleArray[i]["count"]);
       var origin = maleArray[i]["bitstring"]["origin"];
       var str = maleArray[i]["bitstring"]["nmds"];
       if (s >= mincount) {
          data[0].values.push({
            x: parseFloat(str.split(",")[0]),
            y: parseFloat(str.split(",")[1]),
            size: s,
            shape: 'circle',
            bitstring: origin         
         });       
       }

    }
    for (i = 0; i < feArray.length; i++) {
       var s = parseInt(feArray[i]["count"]);
       var origin = feArray[i]["bitstring"]["origin"];
       var str = feArray[i]["bitstring"]["nmds"];
       if (s >= mincount) {
          data[1].values.push({
            x: parseFloat(str.split(",")[0]),
            y: parseFloat(str.split(",")[1]),
            size: s,
            shape: 'circle',
            bitstring: origin         
         });       
       }

    }

  } else if (group == "groupE"){ //group by education
    var data = [{key: "Edu1", values: []}, {key: "Edu2", values: []}, {key: "Edu3", values: []}, {key: "Edu4", values: []}];
    var e1 = source["data"]["edu1"];
    var e2 = source["data"]["edu2"];
    var e3 = source["data"]["edu3"];
    var e4 = source["data"]["edu4"]; 
    for (i = 0; i < e1.length; i++) {
       var s = parseInt(e1[i]["count"]);
       var origin = e1[i]["bitstring"]["origin"];
       var str = e1[i]["bitstring"]["nmds"];
       if (s >= mincount) {
         data[0].values.push({
            x: parseFloat(str.split(",")[0]),
            y: parseFloat(str.split(",")[1]),
            size: s,
            shape: 'circle',
            bitstring: origin         
         });        
       }
    }

    for (i = 0; i < e2.length; i++) {
       var origin = e2[i]["bitstring"]["origin"];
       var str = e2[i]["bitstring"]["nmds"];
       var s = parseInt(e2[i]["count"]);
       if (s >= mincount) {
         data[1].values.push({
            x: parseFloat(str.split(",")[0]),
            y: parseFloat(str.split(",")[1]),
            size: s,
            shape: 'circle',
            bitstring: origin         
         });        
       }

    }
    for (i = 0; i < e3.length; i++) {
       var origin = e3[i]["bitstring"]["origin"];
       var str = e3[i]["bitstring"]["nmds"];
       var s = parseInt(e3[i]["count"]);
       if (s >= mincount) {
          data[2].values.push({
            x: parseFloat(str.split(",")[0]),
            y: parseFloat(str.split(",")[1]),
            size: s,
            shape: 'circle',
            bitstring: origin         
         });       
       }

    }
    for (i = 0; i < e4.length; i++) {
       var origin = e4[i]["bitstring"]["origin"];
       var str = e4[i]["bitstring"]["nmds"];
       var s = parseInt(e4[i]["count"]);
       if (s >= mincount) {
          data[3].values.push({
            x: parseFloat(str.split(",")[0]),
            y: parseFloat(str.split(",")[1]),
            size: s,
            shape: 'circle',
            bitstring: origin         
         });       
       }

    }    
  }
  else{
    var k = Object.keys(source["centroids"]).length;
    var data =[];
    var centroids = source["centroids"];  
    for(i=0;i<k;i++){

    values=[];
    var group_data = source["data"]["group"+i.toString()];
    for (j = 0; j < group_data.length; j++) {
       var s = parseInt(group_data[j]["count"]);
       var origin = group_data[j]["bitstring"]["origin"];
       var str = group_data[j]["bitstring"]["nmds"];
       if (s >= mincount) {
         values.push({
            x: parseFloat(str.split(",")[0]),
            y: parseFloat(str.split(",")[1]),
            size: s,
            shape: 'circle',
            bitstring: origin         
         });        
       }
    }
    data.push({"key":"k"+i.toString(), "values":values});


    }

    for (i = 0; i < k; i++) {
          var str = centroids["group"+i.toString()]["coordinate"];
          console.log(str);    
          data[i].values.push({
            x: parseFloat(str[0]),
            y: parseFloat(str[1]),
            size: parseInt(centroids["group"+i.toString()]["avg_count"]),
            shape:"square",

         });       
       

    }

}
  
  data.push({key:"bar",values:[
                    {x: parseFloat("0.745"),
                    y: parseFloat("0.775"),
                    size: 0,
                    shape:"square",},
                    {x: parseFloat("-0.775"),
                    y: parseFloat("-0.725"),
                    size: 0,
                    shape:"square",}


]
                    })                   
  
 console.log(data);
  return data;
}



</script>


</body>
</html>
